@page "/events"
@using EventEase.Models
@using EventEase.Services
@inject EventService EventService
@inject NavigationManager Navigation

<PageTitle>Events</PageTitle>

<div class="events-container">
    <h1>EventEase - Browse Events</h1>
    
    <div class="filter-section">
        <label for="categoryFilter">Filter by Category:</label>
        <select id="categoryFilter" @bind="selectedCategory" @bind:after="FilterEvents">
            <option value="">All Categories</option>
            <option value="Technology">Technology</option>
            <option value="Business">Business</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Education">Education</option>
        </select>
    </div>

    @if (isLoading)
    {
        <p><em>Loading events...</em></p>
    }
    else if (displayedEvents.Any())
    {
        <div class="events-grid">
            @foreach (var eventItem in displayedEvents)
            {
                <EventCard 
                    EventName="@eventItem.Name"
                    EventDate="@eventItem.Date"
                    Location="@eventItem.Location"
                    OnViewDetails="@(() => ViewEventDetails(eventItem.Id))" />
            }
        </div>
    }
    else
    {
        <p class="no-events">No events found.</p>
    }
</div>

@code {
    private List<Event> allEvents = new();
    private List<Event> displayedEvents = new();
    private string selectedCategory = string.Empty;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadEvents();
    }

    private async Task LoadEvents()
    {
        isLoading = true;
        allEvents = await EventService.GetAllEventsAsync();
        displayedEvents = allEvents;
        isLoading = false;
    }

    private async Task FilterEvents()
    {
        if (string.IsNullOrEmpty(selectedCategory))
        {
            displayedEvents = allEvents;
        }
        else
        {
            displayedEvents = await EventService.GetEventsByCategoryAsync(selectedCategory);
        }
    }

    private void ViewEventDetails(int eventId)
    {
        Navigation.NavigateTo($"/event/{eventId}");
    }
}

<style>
    .events-container {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .events-container h1 {
        text-align: center;
        color: #007bff;
        margin-bottom: 30px;
    }

    .filter-section {
        margin-bottom: 30px;
        text-align: center;
    }

    .filter-section label {
        margin-right: 10px;
        font-weight: bold;
    }

    .filter-section select {
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1rem;
    }

    .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    .no-events {
        text-align: center;
        font-size: 1.2rem;
        color: #666;
        margin-top: 50px;
    }
</style>
